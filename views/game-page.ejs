<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title><%= game.title %></title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<%- include('../Templates/header'); -%>
<main class="main">
    <div class="game-top-row">
        <div class="game-cover">
            <% if (game.imageURL) { %>
                <img class="game-cover-img" src="<%= game.imageURL %>" alt="<%= game.title %>">
            <% } else { %>
                <div class="game-cover-placeholder">[Немає зображення]</div>
            <% } %>
        </div>
        <div class="game-meta">
            <h1><%= game.title %></h1>
            <div class="game-meta-info">
                <span><b>Жанр:</b> <%= game.genre %></span>
                <span><b>Рік:</b> <%= game.release_year || "невідомо" %></span>
                <span><b>Розробник:</b> <%= game.developer || "невідомо" %></span>
                <% if (game.rating) { %>
                    <span><b>Середня оцінка:</b> <%= game.rating %></span>
                <% } %>
            </div>
            <div class="game-description">
                <b>Опис:</b>
                <p><%= game.description || 'Опису немає.' %></p>
            </div>
            <% if (user) { %>
                <% if (user.isAdmin) { %>    
                    <div class="game-edit-btns">
                        <a href="/games/<%= game.id %>/edit" class="edit-btn">Редагувати</a>
                        <form action="/games/<%= game.id %>?_method=DELETE" method="POST" style="display:inline;">
                        <button type="submit" class="delete-btn" onclick="return confirm('Точно видалити гру?')">Видалити</button>
                        </form>
                    </div>
                <% } %>
            <% } %>

        </div>
    </div>

    <% if (game.trailerYoutubeId) { %>
        <div class="game-trailer">
            <iframe width="560" height="315"
                src="https://www.youtube.com/embed/<%= game.trailerYoutubeId %>"
                allowfullscreen>
            </iframe>
        </div>
    <% } %>

    <hr style="margin: 28px 0;">

    <div class="game-reviews">
        <h2>Відгуки</h2>
        <% if (reviews && reviews.length > 0) { %>
            <ul>
            <% reviews.forEach(function(review) { %>
                <li style="margin-bottom:18px;">
                    <b><%= review.authorName %></b>
                    <span style="color: #ffd700">[<%= review.rating %>★]</span><br>
                    <%= review.text %>
                </li>
            <% }) %>
            </ul>
        <% } else { %>
            <div>Ще немає відгуків. Будь першим!</div>
        <% } %>
    </div>

    <% if (user) { %>
        <hr style="margin: 20px 0;">
        <h3>Залишити відгук</h3>
        <form action="/review/<%= game.id %>" method="post" class="auth-form">
            <label>
                Оцінка (1-10):<br>
                <input type="number" name="rating" min="1" max="10" required>
            </label>
            <br>
            <label>
                Ваш відгук:<br>
                <textarea name="text" rows="3" cols="40" required></textarea>
            </label>
            <br>
            <button type="submit" class="btn">Додати відгук</button>
        </form>
    <% } else { %>
        <div style="margin-top:18px;">Щоб залишити відгук, <a href="/login">увійдіть у акаунт</a>.</div>
    <% } %>
</main>

<script src=""></script>
</body>
</html>
